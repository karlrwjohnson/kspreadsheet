<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel='stylesheet' href='styles-main.css' />
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
</head>
<body>
  <p>Hello</p>
  <div id='instructions'>
    <h1>How to use</h1>
    <ul>
      <li>Click in a box to type</li>
      <li>Drag the right edge of a box to grow or shrink it</li>
      <li>Move a table by hovering over it and grabbing the textured border</li>
      <li>Navigate a table using Tab and Enter to move right and down, and
        Shift+Tab and Shift+Enter to move left and up.</li>
      <li>Add columns and rows to a table by tabbing or entering past the
        edge of it</li>
    </ul>
  </div>
</body>

<script>
  'use strict';

  // Shut up, WebStorm. "nw" is totally a global variable.
  var nw;

  //noinspection JSUnresolvedFunction,JSUnresolvedVariable
  nw.Window.get().showDevTools();

  nw.path = nw.require('path');
  const require = nw.root.endsWith('/nwjs/resources/nwjs_default_app') ?
      function require(path) {
        // Kludge: require() using relative paths is broken when running
        // under Selenium.
        const realRoot = nw.root.replace(/\/nwjs\/resources\/nwjs_default_app/, '');
        return nw.require(nw.path.isAbsolute(path) ? path : nw.path.join(realRoot, path));
      } :
      nw.require;

  require('./src/util/globalsBugWorkaround')(window);

  // Imports
  const Dom = require('./src/util/Dom');
  const Worksheet = require('./src/model/Worksheet');
  const WorksheetController = require('./src/controller/WorksheetController');

  // Initialize DOM helper module
  Dom.document = document;

  // Globals
  const doc = new Worksheet();
  const worksheetController = new WorksheetController(doc);

  const instructionPane = Dom.aside(document.getElementById('instructions'));
  instructionPane.style.display = 'none';

  const helpButton = Dom.a({style: 'float:right;display:inline-block;float:right;'}, 'Show/Hide Help');
  helpButton.addEventListener('click', () =>
    instructionPane.style.display = instructionPane.style.display === 'none' ? '' : 'none'
  );

  // Build page
  document.body.appendChild(
    Dom.div({id: 'app-root', 'class': 'flex-row'},
      Dom.div({'class': 'flex-column flex-grow'},
        Dom.header(
          helpButton,
          Dom.h1('KSpreadsheet')
        ),
        worksheetController.element
      ),
      instructionPane
    )
  );

  function demo () {
    worksheetController.worksheet = new Worksheet(require('./src/demo/characterSheet.json'));
  }

  demo();

  console.log('ok');

</script>
</html>
